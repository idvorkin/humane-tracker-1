{"ast":null,"code":"import React,{useState}from'react';import{HabitService}from'../services/habitService';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const habitService=new HabitService();export const CleanupDuplicates=_ref=>{let{userId,onComplete}=_ref;const[isProcessing,setIsProcessing]=useState(false);const[status,setStatus]=useState('');const[duplicatesFound,setDuplicatesFound]=useState([]);const handleCleanup=async()=>{setIsProcessing(true);setStatus('Scanning for duplicate habits...');try{// Fetch all habits\nconst allHabits=await habitService.getUserHabits(userId);// Group habits by name\nconst habitsByName=allHabits.reduce((acc,habit)=>{if(!acc[habit.name]){acc[habit.name]=[];}acc[habit.name].push(habit);return acc;},{});// Find duplicates\nconst duplicateNames=[];let deletedCount=0;for(const[name,habits]of Object.entries(habitsByName)){if(habits.length>1){duplicateNames.push(\"\".concat(name,\" (\").concat(habits.length,\" copies)\"));// Sort by creation date, keep the oldest one\nhabits.sort((a,b)=>{const dateA=a.createdAt instanceof Date?a.createdAt.getTime():0;const dateB=b.createdAt instanceof Date?b.createdAt.getTime():0;return dateA-dateB;});// Delete all but the first (oldest) habit\nfor(let i=1;i<habits.length;i++){setStatus(\"Removing duplicate: \".concat(name,\"...\"));await habitService.deleteHabit(habits[i].id);deletedCount++;}}}if(duplicateNames.length>0){setDuplicatesFound(duplicateNames);setStatus(\"Cleanup complete! Removed \".concat(deletedCount,\" duplicate habits.\"));}else{setStatus('No duplicates found!');}// Wait a moment then close\nsetTimeout(()=>{onComplete();},3000);}catch(error){console.error('Error during cleanup:',error);setStatus('Error during cleanup. Check console for details.');}finally{setIsProcessing(false);}};return/*#__PURE__*/_jsx(\"div\",{style:{position:'fixed',top:0,left:0,right:0,bottom:0,background:'rgba(0, 0, 0, 0.8)',display:'flex',justifyContent:'center',alignItems:'center',zIndex:1000},children:/*#__PURE__*/_jsxs(\"div\",{style:{background:'#242424',padding:'30px',borderRadius:'8px',border:'1px solid #333',maxWidth:'500px',width:'90%'},children:[/*#__PURE__*/_jsx(\"h2\",{style:{color:'#60a5fa',marginBottom:'20px'},children:\"Clean Up Duplicate Habits\"}),/*#__PURE__*/_jsx(\"p\",{style:{color:'#94a3b8',marginBottom:'20px'},children:\"This will scan for habits with the same name and remove duplicates, keeping only the oldest one with its entries intact.\"}),duplicatesFound.length>0&&/*#__PURE__*/_jsxs(\"div\",{style:{background:'#1a1a1a',padding:'10px',borderRadius:'4px',marginBottom:'20px',maxHeight:'150px',overflowY:'auto'},children:[/*#__PURE__*/_jsx(\"div\",{style:{color:'#fbbf24',fontSize:'12px',marginBottom:'5px'},children:\"Duplicates found:\"}),duplicatesFound.map((dup,idx)=>/*#__PURE__*/_jsxs(\"div\",{style:{color:'#64748b',fontSize:'12px'},children:[\"\\u2022 \",dup]},idx))]}),status&&/*#__PURE__*/_jsx(\"div\",{style:{color:status.includes('complete')?'#22c55e':'#94a3b8',marginBottom:'20px',fontSize:'14px'},children:status}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',gap:'10px',justifyContent:'flex-end'},children:[/*#__PURE__*/_jsx(\"button\",{onClick:onComplete,disabled:isProcessing,style:{padding:'8px 20px',background:'#2a2a2a',color:'#94a3b8',border:'1px solid #333',borderRadius:'6px',cursor:isProcessing?'not-allowed':'pointer',opacity:isProcessing?0.5:1},children:\"Cancel\"}),/*#__PURE__*/_jsx(\"button\",{onClick:handleCleanup,disabled:isProcessing,style:{padding:'8px 20px',background:'#ef4444',color:'#fff',border:'none',borderRadius:'6px',cursor:isProcessing?'not-allowed':'pointer',opacity:isProcessing?0.5:1},children:isProcessing?'Processing...':'Clean Up Duplicates'})]})]})});};","map":{"version":3,"names":["React","useState","HabitService","jsx","_jsx","jsxs","_jsxs","habitService","CleanupDuplicates","_ref","userId","onComplete","isProcessing","setIsProcessing","status","setStatus","duplicatesFound","setDuplicatesFound","handleCleanup","allHabits","getUserHabits","habitsByName","reduce","acc","habit","name","push","duplicateNames","deletedCount","habits","Object","entries","length","concat","sort","a","b","dateA","createdAt","Date","getTime","dateB","i","deleteHabit","id","setTimeout","error","console","style","position","top","left","right","bottom","background","display","justifyContent","alignItems","zIndex","children","padding","borderRadius","border","maxWidth","width","color","marginBottom","maxHeight","overflowY","fontSize","map","dup","idx","includes","gap","onClick","disabled","cursor","opacity"],"sources":["/Users/idvorkin/gits/humane-tracker-1/humane-tracker/src/components/CleanupDuplicates.tsx"],"sourcesContent":["import React, { useState } from 'react';\nimport { HabitService } from '../services/habitService';\nimport { Habit } from '../types/habit';\n\nconst habitService = new HabitService();\n\ninterface CleanupDuplicatesProps {\n  userId: string;\n  onComplete: () => void;\n}\n\nexport const CleanupDuplicates: React.FC<CleanupDuplicatesProps> = ({ userId, onComplete }) => {\n  const [isProcessing, setIsProcessing] = useState(false);\n  const [status, setStatus] = useState<string>('');\n  const [duplicatesFound, setDuplicatesFound] = useState<string[]>([]);\n\n  const handleCleanup = async () => {\n    setIsProcessing(true);\n    setStatus('Scanning for duplicate habits...');\n    \n    try {\n      // Fetch all habits\n      const allHabits = await habitService.getUserHabits(userId);\n      \n      // Group habits by name\n      const habitsByName = allHabits.reduce((acc, habit) => {\n        if (!acc[habit.name]) {\n          acc[habit.name] = [];\n        }\n        acc[habit.name].push(habit);\n        return acc;\n      }, {} as Record<string, Habit[]>);\n      \n      // Find duplicates\n      const duplicateNames: string[] = [];\n      let deletedCount = 0;\n      \n      for (const [name, habits] of Object.entries(habitsByName)) {\n        if (habits.length > 1) {\n          duplicateNames.push(`${name} (${habits.length} copies)`);\n          \n          // Sort by creation date, keep the oldest one\n          habits.sort((a, b) => {\n            const dateA = a.createdAt instanceof Date ? a.createdAt.getTime() : 0;\n            const dateB = b.createdAt instanceof Date ? b.createdAt.getTime() : 0;\n            return dateA - dateB;\n          });\n          \n          // Delete all but the first (oldest) habit\n          for (let i = 1; i < habits.length; i++) {\n            setStatus(`Removing duplicate: ${name}...`);\n            await habitService.deleteHabit(habits[i].id);\n            deletedCount++;\n          }\n        }\n      }\n      \n      if (duplicateNames.length > 0) {\n        setDuplicatesFound(duplicateNames);\n        setStatus(`Cleanup complete! Removed ${deletedCount} duplicate habits.`);\n      } else {\n        setStatus('No duplicates found!');\n      }\n      \n      // Wait a moment then close\n      setTimeout(() => {\n        onComplete();\n      }, 3000);\n      \n    } catch (error) {\n      console.error('Error during cleanup:', error);\n      setStatus('Error during cleanup. Check console for details.');\n    } finally {\n      setIsProcessing(false);\n    }\n  };\n\n  return (\n    <div style={{\n      position: 'fixed',\n      top: 0,\n      left: 0,\n      right: 0,\n      bottom: 0,\n      background: 'rgba(0, 0, 0, 0.8)',\n      display: 'flex',\n      justifyContent: 'center',\n      alignItems: 'center',\n      zIndex: 1000\n    }}>\n      <div style={{\n        background: '#242424',\n        padding: '30px',\n        borderRadius: '8px',\n        border: '1px solid #333',\n        maxWidth: '500px',\n        width: '90%'\n      }}>\n        <h2 style={{ color: '#60a5fa', marginBottom: '20px' }}>Clean Up Duplicate Habits</h2>\n        \n        <p style={{ color: '#94a3b8', marginBottom: '20px' }}>\n          This will scan for habits with the same name and remove duplicates, \n          keeping only the oldest one with its entries intact.\n        </p>\n        \n        {duplicatesFound.length > 0 && (\n          <div style={{\n            background: '#1a1a1a',\n            padding: '10px',\n            borderRadius: '4px',\n            marginBottom: '20px',\n            maxHeight: '150px',\n            overflowY: 'auto'\n          }}>\n            <div style={{ color: '#fbbf24', fontSize: '12px', marginBottom: '5px' }}>\n              Duplicates found:\n            </div>\n            {duplicatesFound.map((dup, idx) => (\n              <div key={idx} style={{ color: '#64748b', fontSize: '12px' }}>â€¢ {dup}</div>\n            ))}\n          </div>\n        )}\n        \n        {status && (\n          <div style={{\n            color: status.includes('complete') ? '#22c55e' : '#94a3b8',\n            marginBottom: '20px',\n            fontSize: '14px'\n          }}>\n            {status}\n          </div>\n        )}\n        \n        <div style={{ display: 'flex', gap: '10px', justifyContent: 'flex-end' }}>\n          <button\n            onClick={onComplete}\n            disabled={isProcessing}\n            style={{\n              padding: '8px 20px',\n              background: '#2a2a2a',\n              color: '#94a3b8',\n              border: '1px solid #333',\n              borderRadius: '6px',\n              cursor: isProcessing ? 'not-allowed' : 'pointer',\n              opacity: isProcessing ? 0.5 : 1\n            }}\n          >\n            Cancel\n          </button>\n          <button\n            onClick={handleCleanup}\n            disabled={isProcessing}\n            style={{\n              padding: '8px 20px',\n              background: '#ef4444',\n              color: '#fff',\n              border: 'none',\n              borderRadius: '6px',\n              cursor: isProcessing ? 'not-allowed' : 'pointer',\n              opacity: isProcessing ? 0.5 : 1\n            }}\n          >\n            {isProcessing ? 'Processing...' : 'Clean Up Duplicates'}\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n};"],"mappings":"AAAA,MAAO,CAAAA,KAAK,EAAIC,QAAQ,KAAQ,OAAO,CACvC,OAASC,YAAY,KAAQ,0BAA0B,CAAC,OAAAC,GAAA,IAAAC,IAAA,CAAAC,IAAA,IAAAC,KAAA,yBAGxD,KAAM,CAAAC,YAAY,CAAG,GAAI,CAAAL,YAAY,CAAC,CAAC,CAOvC,MAAO,MAAM,CAAAM,iBAAmD,CAAGC,IAAA,EAA4B,IAA3B,CAAEC,MAAM,CAAEC,UAAW,CAAC,CAAAF,IAAA,CACxF,KAAM,CAACG,YAAY,CAAEC,eAAe,CAAC,CAAGZ,QAAQ,CAAC,KAAK,CAAC,CACvD,KAAM,CAACa,MAAM,CAAEC,SAAS,CAAC,CAAGd,QAAQ,CAAS,EAAE,CAAC,CAChD,KAAM,CAACe,eAAe,CAAEC,kBAAkB,CAAC,CAAGhB,QAAQ,CAAW,EAAE,CAAC,CAEpE,KAAM,CAAAiB,aAAa,CAAG,KAAAA,CAAA,GAAY,CAChCL,eAAe,CAAC,IAAI,CAAC,CACrBE,SAAS,CAAC,kCAAkC,CAAC,CAE7C,GAAI,CACF;AACA,KAAM,CAAAI,SAAS,CAAG,KAAM,CAAAZ,YAAY,CAACa,aAAa,CAACV,MAAM,CAAC,CAE1D;AACA,KAAM,CAAAW,YAAY,CAAGF,SAAS,CAACG,MAAM,CAAC,CAACC,GAAG,CAAEC,KAAK,GAAK,CACpD,GAAI,CAACD,GAAG,CAACC,KAAK,CAACC,IAAI,CAAC,CAAE,CACpBF,GAAG,CAACC,KAAK,CAACC,IAAI,CAAC,CAAG,EAAE,CACtB,CACAF,GAAG,CAACC,KAAK,CAACC,IAAI,CAAC,CAACC,IAAI,CAACF,KAAK,CAAC,CAC3B,MAAO,CAAAD,GAAG,CACZ,CAAC,CAAE,CAAC,CAA4B,CAAC,CAEjC;AACA,KAAM,CAAAI,cAAwB,CAAG,EAAE,CACnC,GAAI,CAAAC,YAAY,CAAG,CAAC,CAEpB,IAAK,KAAM,CAACH,IAAI,CAAEI,MAAM,CAAC,EAAI,CAAAC,MAAM,CAACC,OAAO,CAACV,YAAY,CAAC,CAAE,CACzD,GAAIQ,MAAM,CAACG,MAAM,CAAG,CAAC,CAAE,CACrBL,cAAc,CAACD,IAAI,IAAAO,MAAA,CAAIR,IAAI,OAAAQ,MAAA,CAAKJ,MAAM,CAACG,MAAM,YAAU,CAAC,CAExD;AACAH,MAAM,CAACK,IAAI,CAAC,CAACC,CAAC,CAAEC,CAAC,GAAK,CACpB,KAAM,CAAAC,KAAK,CAAGF,CAAC,CAACG,SAAS,WAAY,CAAAC,IAAI,CAAGJ,CAAC,CAACG,SAAS,CAACE,OAAO,CAAC,CAAC,CAAG,CAAC,CACrE,KAAM,CAAAC,KAAK,CAAGL,CAAC,CAACE,SAAS,WAAY,CAAAC,IAAI,CAAGH,CAAC,CAACE,SAAS,CAACE,OAAO,CAAC,CAAC,CAAG,CAAC,CACrE,MAAO,CAAAH,KAAK,CAAGI,KAAK,CACtB,CAAC,CAAC,CAEF;AACA,IAAK,GAAI,CAAAC,CAAC,CAAG,CAAC,CAAEA,CAAC,CAAGb,MAAM,CAACG,MAAM,CAAEU,CAAC,EAAE,CAAE,CACtC3B,SAAS,wBAAAkB,MAAA,CAAwBR,IAAI,OAAK,CAAC,CAC3C,KAAM,CAAAlB,YAAY,CAACoC,WAAW,CAACd,MAAM,CAACa,CAAC,CAAC,CAACE,EAAE,CAAC,CAC5ChB,YAAY,EAAE,CAChB,CACF,CACF,CAEA,GAAID,cAAc,CAACK,MAAM,CAAG,CAAC,CAAE,CAC7Bf,kBAAkB,CAACU,cAAc,CAAC,CAClCZ,SAAS,8BAAAkB,MAAA,CAA8BL,YAAY,sBAAoB,CAAC,CAC1E,CAAC,IAAM,CACLb,SAAS,CAAC,sBAAsB,CAAC,CACnC,CAEA;AACA8B,UAAU,CAAC,IAAM,CACflC,UAAU,CAAC,CAAC,CACd,CAAC,CAAE,IAAI,CAAC,CAEV,CAAE,MAAOmC,KAAK,CAAE,CACdC,OAAO,CAACD,KAAK,CAAC,uBAAuB,CAAEA,KAAK,CAAC,CAC7C/B,SAAS,CAAC,kDAAkD,CAAC,CAC/D,CAAC,OAAS,CACRF,eAAe,CAAC,KAAK,CAAC,CACxB,CACF,CAAC,CAED,mBACET,IAAA,QAAK4C,KAAK,CAAE,CACVC,QAAQ,CAAE,OAAO,CACjBC,GAAG,CAAE,CAAC,CACNC,IAAI,CAAE,CAAC,CACPC,KAAK,CAAE,CAAC,CACRC,MAAM,CAAE,CAAC,CACTC,UAAU,CAAE,oBAAoB,CAChCC,OAAO,CAAE,MAAM,CACfC,cAAc,CAAE,QAAQ,CACxBC,UAAU,CAAE,QAAQ,CACpBC,MAAM,CAAE,IACV,CAAE,CAAAC,QAAA,cACArD,KAAA,QAAK0C,KAAK,CAAE,CACVM,UAAU,CAAE,SAAS,CACrBM,OAAO,CAAE,MAAM,CACfC,YAAY,CAAE,KAAK,CACnBC,MAAM,CAAE,gBAAgB,CACxBC,QAAQ,CAAE,OAAO,CACjBC,KAAK,CAAE,KACT,CAAE,CAAAL,QAAA,eACAvD,IAAA,OAAI4C,KAAK,CAAE,CAAEiB,KAAK,CAAE,SAAS,CAAEC,YAAY,CAAE,MAAO,CAAE,CAAAP,QAAA,CAAC,2BAAyB,CAAI,CAAC,cAErFvD,IAAA,MAAG4C,KAAK,CAAE,CAAEiB,KAAK,CAAE,SAAS,CAAEC,YAAY,CAAE,MAAO,CAAE,CAAAP,QAAA,CAAC,0HAGtD,CAAG,CAAC,CAEH3C,eAAe,CAACgB,MAAM,CAAG,CAAC,eACzB1B,KAAA,QAAK0C,KAAK,CAAE,CACVM,UAAU,CAAE,SAAS,CACrBM,OAAO,CAAE,MAAM,CACfC,YAAY,CAAE,KAAK,CACnBK,YAAY,CAAE,MAAM,CACpBC,SAAS,CAAE,OAAO,CAClBC,SAAS,CAAE,MACb,CAAE,CAAAT,QAAA,eACAvD,IAAA,QAAK4C,KAAK,CAAE,CAAEiB,KAAK,CAAE,SAAS,CAAEI,QAAQ,CAAE,MAAM,CAAEH,YAAY,CAAE,KAAM,CAAE,CAAAP,QAAA,CAAC,mBAEzE,CAAK,CAAC,CACL3C,eAAe,CAACsD,GAAG,CAAC,CAACC,GAAG,CAAEC,GAAG,gBAC5BlE,KAAA,QAAe0C,KAAK,CAAE,CAAEiB,KAAK,CAAE,SAAS,CAAEI,QAAQ,CAAE,MAAO,CAAE,CAAAV,QAAA,EAAC,SAAE,CAACY,GAAG,GAA1DC,GAAgE,CAC3E,CAAC,EACC,CACN,CAEA1D,MAAM,eACLV,IAAA,QAAK4C,KAAK,CAAE,CACViB,KAAK,CAAEnD,MAAM,CAAC2D,QAAQ,CAAC,UAAU,CAAC,CAAG,SAAS,CAAG,SAAS,CAC1DP,YAAY,CAAE,MAAM,CACpBG,QAAQ,CAAE,MACZ,CAAE,CAAAV,QAAA,CACC7C,MAAM,CACJ,CACN,cAEDR,KAAA,QAAK0C,KAAK,CAAE,CAAEO,OAAO,CAAE,MAAM,CAAEmB,GAAG,CAAE,MAAM,CAAElB,cAAc,CAAE,UAAW,CAAE,CAAAG,QAAA,eACvEvD,IAAA,WACEuE,OAAO,CAAEhE,UAAW,CACpBiE,QAAQ,CAAEhE,YAAa,CACvBoC,KAAK,CAAE,CACLY,OAAO,CAAE,UAAU,CACnBN,UAAU,CAAE,SAAS,CACrBW,KAAK,CAAE,SAAS,CAChBH,MAAM,CAAE,gBAAgB,CACxBD,YAAY,CAAE,KAAK,CACnBgB,MAAM,CAAEjE,YAAY,CAAG,aAAa,CAAG,SAAS,CAChDkE,OAAO,CAAElE,YAAY,CAAG,GAAG,CAAG,CAChC,CAAE,CAAA+C,QAAA,CACH,QAED,CAAQ,CAAC,cACTvD,IAAA,WACEuE,OAAO,CAAEzD,aAAc,CACvB0D,QAAQ,CAAEhE,YAAa,CACvBoC,KAAK,CAAE,CACLY,OAAO,CAAE,UAAU,CACnBN,UAAU,CAAE,SAAS,CACrBW,KAAK,CAAE,MAAM,CACbH,MAAM,CAAE,MAAM,CACdD,YAAY,CAAE,KAAK,CACnBgB,MAAM,CAAEjE,YAAY,CAAG,aAAa,CAAG,SAAS,CAChDkE,OAAO,CAAElE,YAAY,CAAG,GAAG,CAAG,CAChC,CAAE,CAAA+C,QAAA,CAED/C,YAAY,CAAG,eAAe,CAAG,qBAAqB,CACjD,CAAC,EACN,CAAC,EACH,CAAC,CACH,CAAC,CAEV,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}