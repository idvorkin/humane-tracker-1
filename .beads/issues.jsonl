{"id":"HT-09r","title":"MAJOR: Missing input validation in affirmationLogRepository.create()","description":"Lines 43-59: create() performs no validation unlike habitRepository which validates name, category, targetPerWeek. Validate userId (not empty), affirmationTitle (not empty), logType (valid enum).","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-16T15:36:48.591045989Z","updated_at":"2025-12-16T16:33:00.192859767Z","closed_at":"2025-12-16T16:33:00.192859767Z","labels":["code-review","repositories","validation"]}
{"id":"HT-0g4","title":"Wrap import/replace in Dexie transaction for atomicity","description":"**Severity: Critical**\n\nThe `importAllData()` function in `dataService.ts` performs 4 separate async operations without a transaction wrapper:\n\n```typescript\nif (mode === \"replace\") {\n  await habitRepository.clear();   // Op 1\n  await entryRepository.clear();   // Op 2\n}\nawait habitRepository.bulkPut(habits);   // Op 3\nawait entryRepository.bulkPut(entries);  // Op 4\n```\n\n## Problem\n- Between each step, LiveQuery subscriptions fire and UI sees inconsistent state\n- If error occurs mid-operation (e.g., after clear but before bulkPut), data is lost with no rollback\n- Cloud sync could be pushing/pulling simultaneously, causing merge conflicts\n- Violates Dexie Cloud's atomicity guarantees\n\n## Solution\nWrap in `db.transaction()`:\n\n```typescript\nimport { db } from \"../config/db\";\n\nreturn db.transaction('rw', db.habits, db.entries, async () =\u003e {\n  if (mode === \"replace\") {\n    await db.habits.clear();\n    await db.entries.clear();\n  }\n  await db.habits.bulkPut(habitsRecords);\n  await db.entries.bulkPut(entriesRecords);\n});\n```\n\n## Reference\nhttps://dexie.org/docs/cloud/consistency\n\u003e \"Any Dexie transaction will be regarded as an atomic all-or-nothing operation when it syncs to the cloud.\"","acceptance_criteria":"- [ ] importAllData wrapped in db.transaction()\n- [ ] All 4 operations (clear habits, clear entries, bulkPut habits, bulkPut entries) in same transaction\n- [ ] Error in any step rolls back entire operation\n- [ ] Existing tests still pass\n- [ ] Manual test: import with intentional error mid-way doesn't corrupt data","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-13T14:17:40.317568536Z","updated_at":"2025-12-13T14:53:27.38201373Z","closed_at":"2025-12-13T14:53:27.38201373Z","labels":["critical","data-integrity","sync"],"dependencies":[{"issue_id":"HT-0g4","depends_on_id":"HT-er4","type":"parent-child","created_at":"2025-12-13T14:17:47.069925935Z","created_by":"daemon"}]}
{"id":"HT-0ou","title":"MAJOR: HabitWithStatus.currentWeekCount can be inconsistent with entries","description":"currentWeekCount and entries can become inconsistent - nothing prevents setting them independently. Consider making currentWeekCount computed via helper function instead of stored field.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-16T15:37:12.789149112Z","updated_at":"2025-12-16T15:37:12.789149112Z","labels":["code-review","type-safety","types"]}
{"id":"HT-0pq","title":"MAJOR: targetPerWeek type accepts any number","description":"HabitRecord.targetPerWeek typed as number but valid values are 1-7. Create constrained type: type TargetPerWeek = 1 | 2 | 3 | 4 | 5 | 6 | 7.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-16T15:37:12.651156013Z","updated_at":"2025-12-16T16:45:31.860344772Z","closed_at":"2025-12-16T16:45:31.860344772Z","labels":["code-review","type-safety","types"]}
{"id":"HT-0r2","title":"Fix read-condition-write race in CleanupDuplicates","description":"**Severity: Medium**\n\n`CleanupDuplicates.tsx` uses a read-condition-write pattern that's vulnerable to race conditions with cloud sync.\n\n## Current Code\n```typescript\n// Read all habits\nconst habits = await habitService.getAllHabitsForUser(userId);\n// Find duplicates in JS\nconst duplicates = findDuplicates(habits);\n// Delete sequentially\nfor (const dup of duplicates) {\n  await habitService.deleteHabit(dup.id);  // Each delete triggers subscription\n}\n```\n\n## Problems\n1. If cloud sync pushes a new habit between read and delete, could delete wrong item\n2. Sequential deletes trigger subscription updates between each one\n3. User could add a habit during cleanup, causing unpredictable behavior\n\n## Solution Options\n\n**Option A: Batch delete in transaction**\n```typescript\nawait db.transaction('rw', db.habits, async () =\u003e {\n  const duplicateIds = [...]; // IDs determined before transaction\n  await db.habits.bulkDelete(duplicateIds);\n});\n```\n\n**Option B: Use where-clause (preferred for Dexie Cloud)**\n```typescript\n// Group habits by name, delete all but first in each group\n// Conditions travel to server and re-execute there\n```\n\n## Reference\nhttps://dexie.org/docs/cloud/consistency\n\u003e \"Avoid reading + JS condition + writing. Instead formulate the condition in a where-clause with a modify expression attached to it.\"","acceptance_criteria":"- [ ] Cleanup operation is atomic (all-or-nothing)\n- [ ] No intermediate UI updates during cleanup\n- [ ] Concurrent habit additions during cleanup don't cause issues\n- [ ] Verify cloud sync doesn't interfere with cleanup operation","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-13T14:17:40.938560534Z","updated_at":"2025-12-13T15:06:05.793435618Z","closed_at":"2025-12-13T15:06:05.793435618Z","labels":["data-integrity","sync"],"dependencies":[{"issue_id":"HT-0r2","depends_on_id":"HT-er4","type":"parent-child","created_at":"2025-12-13T14:17:47.391597493Z","created_by":"daemon"}]}
{"id":"HT-0xo","title":"MAJOR: Missing error path tests in habitRepository.ts","description":"Test file only tests validators. No tests for actual repository operations or error handling: create() error handling, update() with invalid updates, bulkDelete() transaction, subscribeByUserId() error callback.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-16T15:37:12.883934923Z","updated_at":"2025-12-16T15:37:12.883934923Z","labels":["code-review","repositories","testing"]}
{"id":"HT-17p","title":"MAJOR: Deprecated navigator.platform in githubService.ts","description":"Lines 51-55: navigator.platform is deprecated. May return empty strings or be removed in future browsers. Use navigator.userAgentData?.platform with fallback.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-16T15:36:48.870049197Z","updated_at":"2025-12-16T16:36:09.339740936Z","closed_at":"2025-12-16T16:36:09.339740936Z","labels":["code-review","deprecation","services"]}
{"id":"HT-2c5","title":"CRITICAL: Memory leak - uncleared setInterval in useVersionCheck.ts","description":"Lines 26-34: setInterval created but never cleared. Every mount/re-register creates new interval without clearing old one. Store interval ID in ref and clear on cleanup.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-16T15:35:30.757864452Z","updated_at":"2025-12-16T16:00:14.999518331Z","closed_at":"2025-12-16T16:00:14.999518331Z","labels":["code-review","hooks","memory-leak"]}
{"id":"HT-2ts","title":"MAJOR: TypeScript any type in HabitEditor.tsx and HabitSettings.tsx","description":"HabitEditor.tsx:166 and HabitSettings.tsx:122,692 use 'as any' for tracking type. Replace with proper type: \"binary\" | \"sets\" | \"hybrid\".","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-16T15:36:18.980959185Z","updated_at":"2025-12-16T16:30:53.951867278Z","closed_at":"2025-12-16T16:30:53.951867278Z","labels":["code-review","components","type-safety"]}
{"id":"HT-3rn","title":"Migration: convert variant habits to tag + raw habits","description":"Create a migration that:\n1. Finds habits with variants[] array\n2. For each variant, creates a new raw habit\n3. Converts parent habit to a tag with childIds pointing to new raw habits\n4. Sets parentIds on the new raw habits\n\nExample:\nBefore: Shoulder Accessory { variants: [Shoulder Y, Wall Slide] }\nAfter: \n- Shoulder Accessory (tag) { childIds: [id1, id2] }\n- Shoulder Y (raw) { parentIds: [shoulder-accessory-id] }\n- Wall Slide (raw) { parentIds: [shoulder-accessory-id] }","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-13T23:38:01.884206534Z","updated_at":"2025-12-13T23:54:04.752823364Z","closed_at":"2025-12-13T23:54:04.752823364Z","dependencies":[{"issue_id":"HT-3rn","depends_on_id":"HT-41t","type":"parent-child","created_at":"2025-12-13T23:38:21.721526447Z","created_by":"daemon"}]}
{"id":"HT-41t","title":"Remove Variants - Replace with Tags","description":"Epic: Remove the embedded variants system and consolidate on tags.\n\nVariants and tags solve the same problem (grouping related activities). Tags are more flexible:\n- Each child has its own target\n- Children can belong to multiple tags\n- Cleaner mental model\n\nThis epic covers:\n1. Data migration (convert variant habits to tag + raw habits)\n2. Entry migration (variantId entries → raw habit entries)\n3. Remove variant fields from types\n4. Remove VariantPicker component\n5. Clean up variant-related code","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-13T23:37:29.138517522Z","updated_at":"2025-12-13T23:54:10.85061972Z","closed_at":"2025-12-13T23:54:10.85061972Z"}
{"id":"HT-4da","title":"Remove variant fields from Entry type","description":"Remove from src/types/habit.ts and src/repositories/types.ts:\n- variantId?: string\n- variantName?: string\n\nAlso remove from entryRepository.ts any variant handling code.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-13T23:38:02.682762816Z","updated_at":"2025-12-13T23:54:04.755152884Z","closed_at":"2025-12-13T23:54:04.755152884Z","dependencies":[{"issue_id":"HT-4da","depends_on_id":"HT-41t","type":"parent-child","created_at":"2025-12-13T23:38:21.969497308Z","created_by":"daemon"},{"issue_id":"HT-4da","depends_on_id":"HT-f2y","type":"blocks","created_at":"2025-12-13T23:38:38.808017663Z","created_by":"daemon"}]}
{"id":"HT-4fl","title":"MAJOR: Silent failures in SyncSection.tsx operations","description":"Lines 233-234, 251-253, 262-264, 271-273: Multiple async operations (Sync Now, etc.) catch errors and only log. User clicks buttons, nothing happens, no feedback. Show toast/alert for each failure.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-16T15:37:36.463005406Z","updated_at":"2025-12-16T16:41:52.910164049Z","closed_at":"2025-12-16T16:41:52.910164049Z","labels":["code-review","components","silent-failure"]}
{"id":"HT-4j9","title":"MAJOR: Missing form accessibility in BugReportDialog.tsx","description":"Lines 99-122: Dialog lacks role=\"dialog\" and aria-modal=\"true\". Submit button missing aria-describedby for error message. Add accessibility attributes.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-16T15:36:18.93225638Z","updated_at":"2025-12-16T16:29:20.430157864Z","closed_at":"2025-12-16T16:29:20.430157864Z","labels":["accessibility","code-review","components"]}
{"id":"HT-4jf","title":"Remove variant fields from Habit type","description":"Remove from src/types/habit.ts and src/repositories/types.ts:\n- variants?: HabitVariant[]\n- allowCustomVariant?: boolean\n- HabitVariant interface\n- HabitVariantRecord interface\n\nAlso remove from habitRepository.ts any variant handling code.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-13T23:38:02.405139092Z","updated_at":"2025-12-13T23:54:04.754774964Z","closed_at":"2025-12-13T23:54:04.754774964Z","dependencies":[{"issue_id":"HT-4jf","depends_on_id":"HT-41t","type":"parent-child","created_at":"2025-12-13T23:38:21.927013936Z","created_by":"daemon"},{"issue_id":"HT-4jf","depends_on_id":"HT-3rn","type":"blocks","created_at":"2025-12-13T23:38:38.740307446Z","created_by":"daemon"},{"issue_id":"HT-4jf","depends_on_id":"HT-f2y","type":"blocks","created_at":"2025-12-13T23:38:38.772113727Z","created_by":"daemon"}]}
{"id":"HT-4nb","title":"CRITICAL: Type safety - value field accepts any number","description":"EntryRecord.value and HabitEntry.value typed as number but codebase uses specific values (0, 0.5, 1-5). Negative or unexpected floats type-check fine. Create constrained type like EntryValue = 0 | 0.5 | 1 | 2 | 3 | 4 | 5.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-16T15:35:56.13084926Z","updated_at":"2025-12-16T16:28:01.639173595Z","closed_at":"2025-12-16T16:28:01.639173595Z","labels":["code-review","type-safety","types"]}
{"id":"HT-4xc","title":"Use update() instead of put() for single-property modifications","description":"**Severity: High**\n\nRepositories currently use `bulkPut()` which replaces entire objects. When two devices modify different properties of the same habit concurrently, last-write-wins means one change is lost.\n\n## Problem\nDevice A changes habit name, Device B changes targetPerWeek. With put(), whichever syncs last overwrites the other's change entirely.\n\n## Current Code\n```typescript\n// habitRepository.ts\nasync update(habit: Habit): Promise\u003cvoid\u003e {\n  await db.habits.put(toRecord(habit));  // Replaces entire object\n}\n```\n\n## Solution\nFor operations that modify specific fields, use `Table.update()`:\n\n```typescript\n// For targeted updates\nasync updateField(id: string, changes: Partial\u003cHabitRecord\u003e): Promise\u003cvoid\u003e {\n  await db.habits.update(id, changes);\n}\n\n// Usage\nawait habitRepository.updateField(habitId, { name: newName });\nawait habitRepository.updateField(habitId, { targetPerWeek: 5 });\n```\n\n## Scope\nIdentify all places where we modify a single property and could use update() instead:\n- Habit name changes\n- Habit category changes  \n- Habit targetPerWeek changes\n- Entry value changes (toggles)\n\n## Reference\nhttps://dexie.org/docs/cloud/best-practices\n\u003e \"Update operations manipulate individual properties rather than replacing entire objects, which prevents conflicts when two different clients mutate different properties on the same object.\"","acceptance_criteria":"- [ ] Add updateField() or similar method to repositories\n- [ ] Identify callsites that modify single properties\n- [ ] Convert appropriate callsites to use update() instead of put()\n- [ ] Keep bulkPut() for import operations (entire object replacement is intentional there)\n- [ ] Test concurrent modifications on two browser tabs","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-13T14:17:40.648215941Z","updated_at":"2025-12-13T15:02:52.631953139Z","closed_at":"2025-12-13T15:02:52.631953139Z","labels":["data-integrity","sync"],"dependencies":[{"issue_id":"HT-4xc","depends_on_id":"HT-er4","type":"parent-child","created_at":"2025-12-13T14:17:47.210925523Z","created_by":"daemon"}]}
{"id":"HT-5m7","title":"MAJOR: Silent failure in DeviceService.setStorageItem()","description":"Lines 14-20: When localStorage fails (quota, private browsing), function silently fails. User preferences don't persist with no indication. Return boolean success status.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-16T15:36:48.827720285Z","updated_at":"2025-12-16T16:33:45.852375054Z","closed_at":"2025-12-16T16:33:45.852375054Z","labels":["code-review","services","silent-failure"]}
{"id":"HT-5m9","title":"MAJOR: habitType/childIds relationship not expressed in types","description":"Relationship between habitType and childIds/parentIds is implicit. A tag without childIds or raw habit with childIds type-checks fine. Consider discriminated union for tag vs raw habits.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-16T15:37:12.722399215Z","updated_at":"2025-12-16T15:37:12.722399215Z","labels":["code-review","type-safety","types"]}
{"id":"HT-5yq","title":"CRITICAL: Silent failure in handleSignIn() swallows login errors","description":"authUtils.ts:79-81: Catch block only logs to console. User has NO indication sign-in failed. Could hide network issues, Dexie Cloud outages, invalid tokens. Return error status so caller can display to user.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-16T15:35:55.824994351Z","updated_at":"2025-12-16T16:00:15.284980186Z","closed_at":"2025-12-16T16:00:15.284980186Z","labels":["auth","code-review","silent-failure"]}
{"id":"HT-6hp","title":"MAJOR: Stale closure in useVersionCheck checkForUpdate","description":"Lines 47-64: Dependency on isChecking causes potential race condition with rapid calls. Use a ref for the checking guard instead of state to avoid stale closure.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-16T15:36:19.130778527Z","updated_at":"2025-12-16T16:34:38.237953933Z","closed_at":"2025-12-16T16:34:38.237953933Z","labels":["code-review","hooks","race-condition"]}
{"id":"HT-6pj","title":"MAJOR: Confusing status logic in habitService.ts","description":"Lines 75-85: Logic for \"today\" vs \"tomorrow\" status is confusing and potentially wrong. When daysNeeded \u003e= targetPerWeek and todayEntry exists, falls through to \"pending\". Status distinction seems arbitrary.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-16T15:36:48.686916261Z","updated_at":"2025-12-16T15:36:48.686916261Z","labels":["code-review","logic","services"]}
{"id":"HT-6ya","title":"MAJOR: Date parsing without error handling in dataService.ts","description":"Lines 43-72: new Date() with invalid strings creates Invalid Date objects silently (getTime() returns NaN). These propagate into database. Add date validation with parseDate() helper that throws on invalid input.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-16T15:36:48.731638513Z","updated_at":"2025-12-16T16:39:06.496171235Z","closed_at":"2025-12-16T16:39:06.496171235Z","labels":["code-review","date-handling","services"]}
{"id":"HT-74r","title":"MINOR: Magic numbers in habitRepository.ts validateTargetPerWeek","description":"Lines 33-53: Min/max/default values (1, 7, 3) are hardcoded. Extract to TARGET_PER_WEEK_MIN, TARGET_PER_WEEK_MAX, TARGET_PER_WEEK_DEFAULT constants.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-16T15:37:36.693102006Z","updated_at":"2025-12-16T16:44:02.035290721Z","closed_at":"2025-12-16T16:44:02.035290721Z","labels":["code-quality","code-review","repositories"]}
{"id":"HT-76v","title":"Update tests: remove variant-related tests","description":"Review and update test files:\n- Remove tests for variant functionality\n- Add tests for tag migration\n- Ensure tag-based tests are comprehensive\n\nCheck:\n- src/repositories/habitRepository.test.ts\n- src/hooks/useHabitTrackerVM.test.ts\n- src/utils/tagUtils.test.ts\n- Any E2E tests using variants","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-13T23:38:03.414313275Z","updated_at":"2025-12-13T23:54:04.756657647Z","closed_at":"2025-12-13T23:54:04.756657647Z","dependencies":[{"issue_id":"HT-76v","depends_on_id":"HT-41t","type":"parent-child","created_at":"2025-12-13T23:38:22.219975645Z","created_by":"daemon"}]}
{"id":"HT-7ic","title":"Data Model: Add tag fields to Habit type","description":"Add habitType, childIds, parentIds fields to Habit interface and repository.\n\nFiles to modify:\n- src/types/habit.ts - Add fields to Habit interface\n- src/repositories/types.ts - Add fields to HabitRecord\n- src/config/db.ts - Bump schema version\n\nNew fields:\n- habitType: 'raw' | 'tag' (default 'raw')\n- childIds?: string[] (for tags: IDs of children)\n- parentIds?: string[] (for reverse lookup)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-13T22:22:25.295723065Z","updated_at":"2025-12-13T22:24:41.16001319Z","closed_at":"2025-12-13T22:24:41.16001319Z","dependencies":[{"issue_id":"HT-7ic","depends_on_id":"HT-aya","type":"parent-child","created_at":"2025-12-13T22:22:36.529408619Z","created_by":"daemon"}]}
{"id":"HT-89h","title":"CRITICAL: Missing unit tests for transactions.ts","description":"runImportTransaction() handles atomic imports but has no tests verifying: transaction rollback on failure, \"replace\" mode clears all tables, \"merge\" mode preserves existing data.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-16T15:35:56.090589771Z","updated_at":"2025-12-16T16:25:57.860594864Z","closed_at":"2025-12-16T16:25:57.860594864Z","labels":["code-review","repositories","testing"]}
{"id":"HT-906","title":"CRITICAL: Missing error handling in affirmationLogRepository.ts","description":"Lines 42-98: Zero try-catch error handling on any database operations unlike entryRepository and habitRepository. All methods need error handling: create(), getAll(), clear(), bulkPut(), getByUserIdAndDate(), getByUserId().","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-16T15:35:30.841269533Z","updated_at":"2025-12-16T16:00:15.074454164Z","closed_at":"2025-12-16T16:00:15.074454164Z","labels":["code-review","error-handling","repositories"]}
{"id":"HT-9br","title":"Remove addEntryWithVariant from VM","description":"In useHabitTrackerVM.ts:\n- Remove addEntryWithVariant method\n- Clean up any variant-related logic\n\nThe TagChildPicker handles child selection differently - entries go to child habits directly.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-13T23:38:03.165320224Z","updated_at":"2025-12-13T23:54:04.756239352Z","closed_at":"2025-12-13T23:54:04.756239352Z","dependencies":[{"issue_id":"HT-9br","depends_on_id":"HT-41t","type":"parent-child","created_at":"2025-12-13T23:38:22.047691935Z","created_by":"daemon"},{"issue_id":"HT-9br","depends_on_id":"HT-4jf","type":"blocks","created_at":"2025-12-13T23:38:38.885809706Z","created_by":"daemon"}]}
{"id":"HT-9ev","title":"Tracker View: Click-on-tag picker","description":"When clicking a tag habit cell, open picker to select which child raw habit to log.\n\nFlow:\n- Click tag cell → opens picker showing child raw habits\n- Select child → creates entry on that raw habit\n- Tag count updates automatically (computed from children)","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-13T22:22:26.558300571Z","updated_at":"2025-12-13T22:55:43.725429496Z","closed_at":"2025-12-13T22:55:43.725429496Z","dependencies":[{"issue_id":"HT-9ev","depends_on_id":"HT-aya","type":"parent-child","created_at":"2025-12-13T22:22:36.685166037Z","created_by":"daemon"},{"issue_id":"HT-9ev","depends_on_id":"HT-k2n","type":"blocks","created_at":"2025-12-13T22:22:43.172165618Z","created_by":"daemon"}]}
{"id":"HT-a0p","title":"CRITICAL: Silent failure in clearLocalAnonymousData() swallows deletion errors","description":"authUtils.ts:47-49: When user chooses \"abandon\" data during sign-in, deletion errors are silently swallowed. User proceeds thinking data was cleared but it may still exist causing conflicts.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-16T15:35:55.872426985Z","updated_at":"2025-12-16T16:03:46.992171871Z","closed_at":"2025-12-16T16:03:46.992171871Z","labels":["auth","code-review","silent-failure"]}
{"id":"HT-a7c","title":"CRITICAL: Silent failure in toggleEntry() swallows database errors","description":"useHabitTrackerVM.ts:472-474: Database errors caught and only logged. User sees UI update but data NOT saved. This is a DATA LOSS scenario - user believes tracking saved when it's not. Show error feedback.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-16T15:35:55.918017115Z","updated_at":"2025-12-16T16:03:47.08050324Z","closed_at":"2025-12-16T16:03:47.08050324Z","labels":["code-review","data-loss","silent-failure"]}
{"id":"HT-a82","title":"MAJOR: Missing date validation in dateUtils.ts getTrailingWeekDateRange","description":"Line 5: No validation that currentDate is valid Date. If passed Invalid Date, function produces garbage output with no error. Add validation: if (isNaN(currentDate.getTime())) throw.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-16T15:37:12.561198549Z","updated_at":"2025-12-16T16:35:15.35181836Z","closed_at":"2025-12-16T16:35:15.35181836Z","labels":["code-review","date-handling","utils"]}
{"id":"HT-asd","title":"MAJOR: useEffect missing loadHabits dependency in HabitSettings.tsx","description":"Lines 90-92: useEffect depends on userId but calls loadHabits() which is not in dependency array. Wrap loadHabits in useCallback and add to deps, or inline the logic.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-16T15:36:19.083958435Z","updated_at":"2025-12-16T16:31:42.69639891Z","closed_at":"2025-12-16T16:31:42.69639891Z","labels":["code-review","components","hooks"]}
{"id":"HT-asl","title":"Data Model: Add notes/sets fields to Entry type","description":"Add write-loose-structure-later fields to HabitEntry.\n\nFiles to modify:\n- src/types/habit.ts - Add SetData interface, add fields to HabitEntry\n- src/repositories/types.ts - Add fields to EntryRecord\n\nNew types/fields:\n- SetData: { weight?, reps?, duration? }\n- notes?: string (freeform entry)\n- sets?: SetData[] (structured data)\n- parsed?: boolean (LLM processed flag)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-13T22:22:25.546302596Z","updated_at":"2025-12-13T22:24:46.311219874Z","closed_at":"2025-12-13T22:24:46.311219874Z","dependencies":[{"issue_id":"HT-asl","depends_on_id":"HT-aya","type":"parent-child","created_at":"2025-12-13T22:22:36.563048273Z","created_by":"daemon"}]}
{"id":"HT-aya","title":"Tag Habits Implementation","description":"Implement the Raw Habits + Tags model as specified in TAG-HABITS-SPEC.md.\n\nKey features:\n- Raw habits (concrete activities) vs Tags (aggregations)\n- Arbitrary nesting of tags\n- Multi-tag membership for raw habits\n- Write loose, structure later (notes + LLM parsing)\n- Independent targets for both raw habits and tags","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-13T22:22:03.965683924Z","updated_at":"2025-12-13T22:55:58.996148706Z","closed_at":"2025-12-13T22:55:58.996148706Z"}
{"id":"HT-bfy","title":"MAJOR: Type duplication between Record and domain types","description":"HabitRecord/Habit and EntryRecord/HabitEntry are nearly identical with only date format differences. Changes must be made in multiple places. Consider deriving domain types from records using mapped types.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-16T15:37:12.605647383Z","updated_at":"2025-12-16T15:37:12.605647383Z","labels":["code-review","refactor","type-safety"]}
{"id":"HT-bgh","title":"MAJOR: Missing null/undefined check in habitValidation.ts","description":"Lines 21, 25: validateHabitForm will throw if data.name or data.category is undefined/null. Add defensive checks: if (!data.name || !data.name.trim()).","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-16T15:36:48.912482567Z","updated_at":"2025-12-16T16:34:50.986363919Z","closed_at":"2025-12-16T16:34:50.986363919Z","labels":["code-review","utils","validation"]}
{"id":"HT-c6r","title":"Comprehensive test coverage for tag system","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-14T00:10:52.607930294Z","updated_at":"2025-12-14T00:15:41.853330686Z","closed_at":"2025-12-14T00:15:41.853330686Z"}
{"id":"HT-d78","title":"MAJOR: Missing update verification in entryRepository.updateValue()","description":"Lines 242-254: updateValue() doesn't verify entry exists before updating. Dexie's update() returns 0 silently if record doesn't exist. Check return value and throw if entry not found.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-16T15:36:48.639371876Z","updated_at":"2025-12-16T16:32:25.837534773Z","closed_at":"2025-12-16T16:32:25.837534773Z","labels":["code-review","repositories","validation"]}
{"id":"HT-da4","title":"CRITICAL: Incomplete data validation in dataService.ts","description":"Lines 85-94: validateExportData() checks arrays exist but NOT structure of individual items. Malformed habit/entry objects pass validation and cause runtime errors during import. Add field validation for each habit and entry object.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-16T15:35:30.882088279Z","updated_at":"2025-12-16T16:00:15.11758915Z","closed_at":"2025-12-16T16:00:15.11758915Z","labels":["code-review","services","validation"]}
{"id":"HT-e1z","title":"MINOR: Subscription error handler returns empty array","description":"entryRepository.ts:322-324 and habitRepository.ts:391-393: When subscription errors, callback([]) called which could overwrite valid cached data. Consider letting UI handle errors instead.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-16T15:37:36.809131267Z","updated_at":"2025-12-16T15:37:36.809131267Z","labels":["code-review","error-handling","repositories"]}
{"id":"HT-e5w","title":"CRITICAL: Date handling inconsistency in affirmationLogRepository.ts","description":"Lines 25-27: Uses raw new Date() instead of normalizeDate/fromDateString helpers. Other repos use normalizeDate() correctly. Can produce incorrect results due to timezone interpretation.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-16T15:35:30.798435239Z","updated_at":"2025-12-16T16:00:15.040326371Z","closed_at":"2025-12-16T16:00:15.040326371Z","labels":["code-review","date-handling","repositories"]}
{"id":"HT-er4","title":"Dexie Cloud Synchronization Hardening","description":"Address synchronization issues identified in architecture review to prevent data loss and race conditions when using Dexie Cloud sync.\n\n## Context\nAudit against Dexie Cloud best practices revealed several patterns that could cause data loss or inconsistencies during cloud sync operations.\n\n## Key Issues\n1. Non-atomic import/replace operations\n2. Using put() instead of update() loses concurrent edits\n3. Read-condition-write patterns in cleanup operations\n\n## References\n- https://dexie.org/docs/cloud/consistency\n- https://dexie.org/docs/cloud/best-practices","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-13T14:17:09.686565221Z","updated_at":"2025-12-13T15:06:12.117426725Z","closed_at":"2025-12-13T15:06:12.117426725Z","labels":["data-integrity","sync"]}
{"id":"HT-eyr","title":"MAJOR: Missing ARIA labels in CleanupDuplicates.tsx modal","description":"Lines 171-200: Modal overlay and buttons lack accessibility attributes. Add role=\"dialog\", aria-modal=\"true\", aria-labelledby for modal, and aria-labels for buttons.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-16T15:36:18.873149088Z","updated_at":"2025-12-16T16:28:53.955246851Z","closed_at":"2025-12-16T16:28:53.955246851Z","labels":["accessibility","code-review","components"]}
{"id":"HT-f2y","title":"Migration: convert variantId entries to raw habit entries","description":"Create a migration that:\n1. Finds entries with variantId field\n2. Maps variantId to the new raw habit ID (from habit migration)\n3. Updates habitId to point to the raw habit\n4. Clears variantId/variantName fields\n\nEntries without variantId on variant habits:\n- Keep them on the (now tag) habit as generic entries\n- This is valid - tags can have direct entries","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-13T23:38:02.155168976Z","updated_at":"2025-12-13T23:54:04.754302293Z","closed_at":"2025-12-13T23:54:04.754302293Z","dependencies":[{"issue_id":"HT-f2y","depends_on_id":"HT-41t","type":"blocks","created_at":"2025-12-13T23:38:02.155811824Z","created_by":"daemon"},{"issue_id":"HT-f2y","depends_on_id":"HT-3rn","type":"blocks","created_at":"2025-12-13T23:38:38.696145822Z","created_by":"daemon"}]}
{"id":"HT-ffn","title":"MAJOR: Missing error UI feedback in HabitManager.tsx","description":"Lines 48-52: Catch block logs error but shows no user feedback. Add setError(\"Failed to create habit. Please try again.\") to inform user.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-16T15:36:18.829515714Z","updated_at":"2025-12-16T16:28:24.074595551Z","closed_at":"2025-12-16T16:28:24.074595551Z","labels":["code-review","components","ux"]}
{"id":"HT-flt","title":"CRITICAL: Silent failure in handleSignOut() swallows logout errors","description":"App.tsx:84-86: Sign-out errors silently swallowed. User may think they logged out (for security on shared device) but session still active. Show error message.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-16T15:35:55.960076067Z","updated_at":"2025-12-16T16:03:47.046780839Z","closed_at":"2025-12-16T16:03:47.046780839Z","labels":["code-review","security","silent-failure"]}
{"id":"HT-g3d","title":"CRITICAL: Custom date formatting in habitTreeUtils.ts violates conventions","description":"Lines 159-162: computeTagCounts uses custom date string format that doesn't pad months/days and uses 0-indexed months. Produces wrong date strings that won't match toDateString() format. Replace with toDateString() from types.ts.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-16T15:35:30.976325475Z","updated_at":"2025-12-16T16:00:15.216173999Z","closed_at":"2025-12-16T16:00:15.216173999Z","labels":["code-review","date-handling","utils"]}
{"id":"HT-gl7","title":"habitRepository.update silently drops fields (hidden, trackingType, childIds, parentIds)","description":"The repository update function only handles 3 fields (name, category, targetPerWeek) but the service layer accepts Partial\u003cHabit\u003e. TypeScript's structural subtyping allows this mismatch, causing silent data loss.\n\nImpact: Visibility toggle, tracking type, and tag child edits in HabitSettings are silently dropped.\n\nRoot cause: Repository was never updated when new fields were added.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-14T01:59:57.156242698Z","updated_at":"2025-12-14T02:00:54.504536058Z","closed_at":"2025-12-14T02:00:54.504536058Z"}
{"id":"HT-gui","title":"CRITICAL: Memory leak - uncleared setTimeout in HabitTracker.tsx","description":"Lines 39-40, 69-76: longPressTimer ref timer is only cleared via event handlers. If component unmounts while timer pending, it still fires. Add cleanup effect.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-16T15:35:30.714348114Z","updated_at":"2025-12-16T16:00:14.96068356Z","closed_at":"2025-12-16T16:00:14.96068356Z","labels":["code-review","components","memory-leak"]}
{"id":"HT-k2n","title":"Tracker View: Render nested tag structure","description":"Update HabitTracker to display tags with nested children.\n\nFeatures:\n- Show tags with computed counts from descendants\n- Expand/collapse tag rows to show/hide children\n- Indent children under parent tags\n- Handle raw habits appearing under multiple tags","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-13T22:22:26.315078317Z","updated_at":"2025-12-13T22:48:01.127894752Z","closed_at":"2025-12-13T22:48:01.127894752Z","dependencies":[{"issue_id":"HT-k2n","depends_on_id":"HT-aya","type":"parent-child","created_at":"2025-12-13T22:22:36.65353614Z","created_by":"daemon"},{"issue_id":"HT-k2n","depends_on_id":"HT-7ic","type":"blocks","created_at":"2025-12-13T22:22:43.143286184Z","created_by":"daemon"}]}
{"id":"HT-kfl","title":"MAJOR: E2E tests use arbitrary timeouts instead of polling","description":"habit-click.spec.ts uses page.waitForTimeout(500) in several places despite having IndexedDB polling helpers. Per CLAUDE.md: \"NEVER use arbitrary timeouts\". Replace with proper waitFor conditions.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-16T15:37:12.835885661Z","updated_at":"2025-12-16T15:37:12.835885661Z","labels":["code-review","flaky-tests","testing"]}
{"id":"HT-km3","title":"MAJOR: Race condition in syncLogService.enforceLimit()","description":"Lines 93-104: Race condition between counting, reading oldest, and deleting logs. Multiple addLog() calls could delete more logs than intended. Wrap in transaction or add debounce/mutex.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-16T15:36:48.780168234Z","updated_at":"2025-12-16T16:42:38.139454834Z","closed_at":"2025-12-16T16:42:38.139454834Z","labels":["code-review","race-condition","services"]}
{"id":"HT-pma","title":"MAJOR: Silent failure in HabitSettings.tsx handleSaveAll()","description":"Lines 229-231: When saving habit changes fails, error logged but dialog closes anyway (onClose() not prevented). User thinks save succeeded. Keep dialog open on error.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-16T15:37:36.324179327Z","updated_at":"2025-12-16T16:40:59.997334978Z","closed_at":"2025-12-16T16:40:59.997334978Z","labels":["code-review","components","silent-failure"]}
{"id":"HT-prs","title":"Update spec: mark variants as deprecated","description":"Update TAG-HABITS-SPEC.md to:\n- Mark variants as deprecated/removed\n- Clarify tags replace variants entirely\n- Update Phase 5 to reflect current work\n- Remove any references to keeping both systems","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-13T23:38:01.644721663Z","updated_at":"2025-12-13T23:47:53.148828639Z","closed_at":"2025-12-13T23:47:53.148828639Z","dependencies":[{"issue_id":"HT-prs","depends_on_id":"HT-41t","type":"parent-child","created_at":"2025-12-13T23:38:21.678267974Z","created_by":"daemon"}]}
{"id":"HT-psv","title":"CRITICAL: Missing unit tests for authUtils.ts","description":"No tests for authentication utilities. Handles data detection, destruction during sign-in, and sign-in flow orchestration. Auth bugs could cause permanent data loss. Need tests for all scenarios.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-16T15:35:56.045329101Z","updated_at":"2025-12-16T16:24:46.103825146Z","closed_at":"2025-12-16T16:24:46.103825146Z","labels":["auth","code-review","testing"]}
{"id":"HT-q2m","title":"MINOR: Magic numbers in useShakeDetector.ts","description":"Lines 31-32: threshold=25 and cooldownMs=2000 are magic numbers. Extract to named constants for maintainability.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-16T15:37:36.644976196Z","updated_at":"2025-12-16T16:44:02.127061718Z","closed_at":"2025-12-16T16:44:02.127061718Z","labels":["code-quality","code-review","hooks"]}
{"id":"HT-q4o","title":"MAJOR: Missing keyboard navigation in TagChildPicker.tsx","description":"Lines 93-117: Picker has Escape key support but no Tab trapping or arrow key navigation for list of options. Add focus management and keyboard navigation.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-16T15:36:19.032692332Z","updated_at":"2025-12-16T15:36:19.032692332Z","labels":["accessibility","code-review","components"]}
{"id":"HT-tjk","title":"MINOR: Video element cleanup in useBugReporter.ts","description":"Lines 149-165: Dynamically created video element has srcObject set but never explicitly cleaned up. Add video.pause() and video.srcObject = null after getting screenshot.","status":"closed","priority":3,"issue_type":"bug","created_at":"2025-12-16T15:37:36.585446061Z","updated_at":"2025-12-16T16:43:03.99490622Z","closed_at":"2025-12-16T16:43:03.99490622Z","labels":["cleanup","code-review","hooks"]}
{"id":"HT-tr1","title":"Tag CRUD: Create and manage tags in HabitSettings","description":"Add UI to create tag habits and assign children.\n\nFeatures:\n- Toggle habitType when creating new habit (raw vs tag)\n- For tags: select which habits to include as children\n- For raw habits: show which tags they belong to\n- Add/remove children from existing tags","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-13T22:22:26.076540164Z","updated_at":"2025-12-13T22:52:57.544719071Z","closed_at":"2025-12-13T22:52:57.544719071Z","dependencies":[{"issue_id":"HT-tr1","depends_on_id":"HT-aya","type":"parent-child","created_at":"2025-12-13T22:22:36.621730836Z","created_by":"daemon"},{"issue_id":"HT-tr1","depends_on_id":"HT-7ic","type":"blocks","created_at":"2025-12-13T22:22:43.112066096Z","created_by":"daemon"}]}
{"id":"HT-umt","title":"MAJOR: Returning mutable ref in useHabitTrackerVM exposes internal state","description":"Line 492: Returns expandedTagsRef.current directly, exposing mutable Set reference. Components can mutate directly, bypassing controlled toggleTagExpanded. Return new Set or ReadonlySet instead.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-16T15:36:19.189628652Z","updated_at":"2025-12-16T16:32:01.433991784Z","closed_at":"2025-12-16T16:32:01.433991784Z","labels":["code-review","encapsulation","hooks"]}
{"id":"HT-uzg","title":"Remove VariantPicker component","description":"Delete:\n- src/components/VariantPicker.tsx\n- src/components/VariantPicker.css\n\nUpdate HabitTracker.tsx:\n- Remove VariantPicker import\n- Remove variantPickerState\n- Remove handleVariantSelect\n- Remove variant-related long-press logic (keep tag long-press)\n- Remove has-variants CSS class usage","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-13T23:38:02.918832939Z","updated_at":"2025-12-13T23:54:04.755524512Z","closed_at":"2025-12-13T23:54:04.755524512Z","dependencies":[{"issue_id":"HT-uzg","depends_on_id":"HT-41t","type":"parent-child","created_at":"2025-12-13T23:38:22.008285177Z","created_by":"daemon"},{"issue_id":"HT-uzg","depends_on_id":"HT-4jf","type":"blocks","created_at":"2025-12-13T23:38:38.846335076Z","created_by":"daemon"}]}
{"id":"HT-vmu","title":"Clean up variant CSS","description":"Remove variant-related CSS:\n- .has-variants class in HabitTracker.css\n- .variant-trigger button styles\n- Any other variant-specific styles\n\nKeep TagChildPicker styles (they're different).","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-13T23:38:03.669661393Z","updated_at":"2025-12-13T23:54:04.757092693Z","closed_at":"2025-12-13T23:54:04.757092693Z","dependencies":[{"issue_id":"HT-vmu","depends_on_id":"HT-41t","type":"parent-child","created_at":"2025-12-13T23:38:22.475160717Z","created_by":"daemon"}]}
{"id":"HT-wja","title":"CRITICAL: Memory leak - uncleared setTimeout in HabitEditor.tsx","description":"Line 81: setTimeout for delete confirmation auto-reset is never cleared if component unmounts. Store timer in ref and clear in cleanup effect.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-16T15:35:30.649999006Z","updated_at":"2025-12-16T16:00:14.901930055Z","closed_at":"2025-12-16T16:00:14.901930055Z","labels":["code-review","components","memory-leak"]}
{"id":"HT-y2o","title":"CRITICAL: Missing unit tests for entryRepository.ts","description":"No test file exists for critical data layer. Handles all habit entry CRUD and date conversions. Need tests for: toEntry() date normalization, getForDateRange() boundaries, add() ID generation, subscribeForDateRange() error handling.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-16T15:35:56.001389643Z","updated_at":"2025-12-16T16:23:32.927040455Z","closed_at":"2025-12-16T16:23:32.927040455Z","labels":["code-review","repositories","testing"]}
{"id":"HT-z5f","title":"MAJOR: Silent failure in HabitSettings.tsx loadHabits()","description":"Lines 115-117: Loading habits failure only logged. User sees empty list with no explanation. Add error state and display message.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-16T15:37:36.39752742Z","updated_at":"2025-12-16T16:40:59.945728494Z","closed_at":"2025-12-16T16:40:59.945728494Z","labels":["code-review","components","silent-failure"]}
{"id":"HT-za6","title":"Data Model: Add cycle detection utility","description":"Create utility to detect cycles when adding parent-child relationships.\n\nPrevent:\n- Tag A contains Tag B, Tag B contains Tag A\n- Any circular dependency in the DAG\n\nImplementation:\n- Function: wouldCreateCycle(parentId, childId, allHabits) -\u003e boolean\n- Use DFS/BFS to check if adding edge creates cycle","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-13T22:22:25.828809841Z","updated_at":"2025-12-13T22:32:26.169175534Z","closed_at":"2025-12-13T22:32:26.169175534Z","dependencies":[{"issue_id":"HT-za6","depends_on_id":"HT-aya","type":"parent-child","created_at":"2025-12-13T22:22:36.593641648Z","created_by":"daemon"}]}
{"id":"HT-zca","title":"CRITICAL: Potential DoS via large base64 input in githubService.ts","description":"Line 204: dataUrlToBlob() has no size limit. Very large base64 string could cause memory exhaustion. Add MAX_DATA_URL_SIZE check (e.g., 10MB) before processing.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-16T15:35:30.93011013Z","updated_at":"2025-12-16T16:00:15.156352919Z","closed_at":"2025-12-16T16:00:15.156352919Z","labels":["code-review","security","services"]}
{"id":"HT-zoq","title":"MAJOR: Unsafe date parsing in tagUtils.ts","description":"Lines 261-263, 291, 307: Uses inline 'e.date instanceof Date ? e.date : new Date(e.date)' pattern. new Date(string) doesn't validate format. Use normalizeDate() from types.ts instead.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-16T15:37:12.513212371Z","updated_at":"2025-12-16T16:37:04.116229123Z","closed_at":"2025-12-16T16:37:04.116229123Z","labels":["code-review","date-handling","utils"]}
{"id":"HT-zpb","title":"MAJOR: Missing getNextEntryValue tag mode tests","description":"useHabitTrackerVM.test.ts: getNextEntryValue tests only cover raw habits. Missing tests for tag toggle behavior: null to 1, 1 to null, any positive to null.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-16T15:37:36.527084555Z","updated_at":"2025-12-16T15:37:36.527084555Z","labels":["code-review","hooks","testing"]}
