#!/bin/bash
# Block direct pushes to main branch
# This ensures all changes go through PRs for code review
#
# This hook receives: $1 = remote name, $2 = remote URL

remote_name="$1"
remote_url="$2"

protected_branch="main"

while read local_ref local_sha remote_ref remote_sha; do
    if [[ "$remote_ref" == "refs/heads/$protected_branch" ]]; then
        echo ""
        echo "ðŸš« Direct push to '$protected_branch' is blocked!"
        echo ""
        echo "   All changes to main should go through PRs for code review."
        echo ""
        echo "   Instead:"
        echo "   1. Create a feature branch: git checkout -b feature/my-change"
        echo "   2. Push your branch: git push origin feature/my-change"
        echo "   3. Create PR: gh pr create"
        echo ""
        echo "   To bypass (emergencies only): git push --no-verify"
        echo ""
        exit 1
    fi
done

exit 0
